# Session Packet: S01

## Segment
- ID: S01
- Deliverable(s): D01 (Agent Manifest Specification)
- Date: 2026-02-12
- Owner: TBD

## Objective
- Primary objective: ship the canonical AgentHub manifest spec (`agent.yaml`) plus interoperability mappings (MCP + A2A) and a working validator command.
- Success criteria: all D01 acceptance criteria are met with test evidence and handoff artifacts for S02.

## Dependencies
- Required prior segments: None
- External dependencies: JSON Schema 2020-12 tooling, YAML parser, test framework
- Blocking issues:
  - None expected

## Stack Alignment
- Language/runtime for this segment: Python 3.11+
- Validation stack: `jsonschema` + `PyYAML`
- Test stack: `pytest`
- Future compatibility target: FastAPI backend + registry workflows in S04

## Scope
### In Scope
- Canonical manifest schema design and validation rules
- A2A mapping specification (bidirectional)
- MCP mapping specification
- Example manifests (3)
- CLI validation command surface for `agenthub manifest validate agent.yaml`
- Negative and compatibility tests

### Out of Scope
- Search API design/implementation (S02)
- Registry API/database implementation (S03/S04)
- Full CLI distribution/publishing (S09)

## Required Output Artifacts
Create or update all of the following:
1. `specs/manifest/agent-manifest-spec-v0.1.yaml`
2. `specs/manifest/examples/simple-tool-agent.yaml`
3. `specs/manifest/examples/multi-capability-agent.yaml`
4. `specs/manifest/examples/pipeline-agent.yaml`
5. `docs/spec/SPEC.md`
6. `docs/spec/a2a-mapping.md`
7. `docs/spec/mcp-mapping.md`
8. `tools/manifest/validate_manifest.py` (or equivalent CLI entrypoint)
9. `tests/manifest/test_schema_valid_examples.py`
10. `tests/manifest/test_schema_invalid_examples.py`
11. `tests/manifest/fixtures/invalid/*` (minimum 5 invalid fixtures)

## Implementation Plan
1. Define top-level schema sections and required/optional fields.
2. Implement strict JSON Schema validation (identity/capabilities/requirements/interfaces/trust/composition/runtime/provenance).
3. Encode explicit security constraints:
   - Secrets must be declared by reference only, never inline secret values.
   - Permission scopes must be explicit and enumerable.
4. Draft A2A mapping:
   - AgentHub manifest -> `.well-known/agent-card.json`
   - A2A agent card -> AgentHub manifest projection
5. Draft MCP mapping:
   - Capability + interface projection -> MCP tool declarations
   - Required parameter and output schema mapping rules
6. Build validator command and error reporting.
7. Add tests for valid manifests, invalid manifests, and mapping consistency.
8. Produce docs and examples aligned with the implemented schema.

## Verification Plan
### Core Verification
- Schema validation with pass/fail fixtures
- A2A and MCP mapping round-trip sanity checks (where applicable)

### API/Schema Checks
- Required fields enforced
- Semver format enforced for `identity.version`
- Capability input/output schema type checks
- Protocol values constrained to approved enum set

### Security Checks
- Inline secret-like fields rejected
- Permission declarations required for privileged interfaces
- Guardrail policy metadata required in trust section

### Cost/Performance Checks
- Validator runtime on all examples + fixtures completes quickly (<2s local target for fixture set)

## Exact Test Commands (Baseline)
Run from repository root:

```bash
python3 -m pip install -U pip
python3 -m pip install pyyaml jsonschema pytest

# Validate known-good manifests
python3 tools/manifest/validate_manifest.py specs/manifest/examples/simple-tool-agent.yaml
python3 tools/manifest/validate_manifest.py specs/manifest/examples/multi-capability-agent.yaml
python3 tools/manifest/validate_manifest.py specs/manifest/examples/pipeline-agent.yaml

# Run automated tests
pytest tests/manifest -q
```

If CLI entrypoint is wired:

```bash
python3 -m agenthub_manifest.cli manifest validate specs/manifest/examples/simple-tool-agent.yaml
```

## Acceptance Criteria (Must Pass)
1. JSON Schema definition completed and validates all 3 canonical examples.
2. At least 5 invalid fixtures fail with clear, actionable error messages.
3. A2A mapping doc includes field-by-field mapping and unsupported-field policy.
4. MCP mapping doc includes field-by-field mapping and schema translation rules.
5. Validator command runs locally and exits non-zero on invalid manifests.
6. `docs/evidence/S01.md` contains executed commands and results.
7. `docs/DELIVERABLE_LOG.md` updated for S01.
8. `docs/agenthub-master-plan-v1.2.docx` updated to reflect S01 completion/progress.

## Risks / Watchouts
- Overfitting schema to current examples instead of long-term extensibility.
- Leaking secrets in example manifests.
- Drift between docs and schema implementation.

## Handoff to S02
S02 must consume these exact outputs:
- `specs/manifest/agent-manifest-spec-v0.1.yaml`
- `docs/spec/SPEC.md`
- `docs/spec/a2a-mapping.md`
- `docs/spec/mcp-mapping.md`
- Validator behavior contracts and known limitations

S02 kickoff dependency check:
- Confirm schema section names and capability shape are stable.
- Confirm trust metadata fields used by ranking are finalized.

## Mandatory Reminder
- Update `docs/agenthub-master-plan-v1.2.docx` immediately after S01 is completed.
- Update `docs/DELIVERABLE_LOG.md` immediately after S01 is completed.

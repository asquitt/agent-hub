# Evidence

## Segment
- ID: S40
- Deliverable(s): Provenance signing
- Date: 2026-02-12

## Code Changes
- Files changed:
  - `src/provenance/__init__.py`
  - `src/provenance/service.py`
  - `src/api/models.py`
  - `src/api/app.py`
  - `tests/provenance/test_provenance_signing_s40.py`
  - `docs/spec/PROVENANCE_SIGNING_S40.md`
  - `docs/session-packets/S40.md`
- Summary:
  - Added provenance signing service for manifests and artifacts using canonicalized payload hashing + HMAC signatures.
  - Added manifest and artifact sign/verify API endpoints.
  - Enforced signer boundary: signer identity must match authenticated owner on signing endpoints.
  - Added tamper-detection regression tests for both service and API flows.

## Test Commands Executed
```bash
pytest tests/provenance/test_provenance_signing_s40.py -q
pytest tests/integration/test_registry_api.py tests/auth/test_identity_v2.py tests/operator/test_operator_ui.py -q
pytest tests/manifest/test_schema_valid_examples.py tests/manifest/test_schema_invalid_examples.py -q
pytest -q
```

## Test Results
- Passed:
  - `3 passed in 0.32s` (provenance suite)
  - `16 passed in 2.14s` (core API compatibility bundle)
  - `9 passed in 0.52s` (manifest validation bundle)
  - `142 passed in 6.40s` (full regression)
- Failed: `0`
- Skipped: `0`

## Verification Evidence
- Signing/verification roundtrip:
  - Manifest and artifact envelopes verify as valid for untampered payloads.
- Tamper detection:
  - Payload mutation or hash mismatch causes deterministic verification failure.
- Boundary enforcement:
  - API rejects sign requests when claimed signer does not match authenticated owner.

## Known Risks
- Current envelope signing uses shared-secret HMAC and does not yet provide external verifier trust without key distribution.
- Key rotation and key version metadata are future hardening work.

## Next Segment Handoff
- Recommended next segment: `S41` (Trust graph v3)
- Required context for next segment:
  - Integrate provenance verification outcomes as trust signals in abuse/collusion reputation logic.

## Mandatory Confirmation
- [x] `docs/agenthub-master-plan-v1.2.docx` updated
- [x] `docs/DELIVERABLE_LOG.md` updated

# Evidence

## Segment
- ID: S44
- Deliverable(s): Marketplace finance v2
- Date: 2026-02-12

## Code Changes
- Files changed:
  - `src/marketplace/storage.py`
  - `src/marketplace/service.py`
  - `src/marketplace/__init__.py`
  - `src/api/models.py`
  - `src/api/app.py`
  - `tests/marketplace/test_marketplace_api.py`
  - `tests/marketplace/test_marketplace_finance_v2_s44.py`
  - `docs/billing/MARKETPLACE_FINANCE_V2_S44.md`
  - `docs/session-packets/S44.md`
- Summary:
  - Added dispute and payout persistence paths to marketplace storage.
  - Added dispute create/list/resolve workflows with resolution validation and capped approvals.
  - Added payout create/list workflows with settlement prerequisite, open-dispute blocking, and idempotent contract payout behavior.
  - Added new marketplace finance API models and endpoints for disputes and payouts.
  - Added S44 finance integrity tests for dispute handling, payout math, and authorization boundaries.

## Test Commands Executed
```bash
pytest tests/marketplace/test_marketplace_api.py tests/marketplace/test_marketplace_finance_v2_s44.py -q
pytest tests/integration/test_registry_api.py tests/cost_governance/test_metering_integration.py -q
pytest -q
```

## Test Results
- Passed:
  - `6 passed in 0.38s` (marketplace API + S44 finance tests)
  - `13 passed in 2.36s` (registry/cost integration bundle)
  - `150 passed in 7.63s` (full regression)
- Failed: `0`
- Skipped: `0`

## Verification Evidence
- Settlement and dispute integrity:
  - Partial dispute approval reduces payout net by approved adjustment.
  - Open disputes block payout until resolution.
  - Approved dispute amounts are bounded by contract settled amount.
- Authorization boundaries:
  - Only platform owner can resolve disputes.
  - Non-platform actors are denied payout execution.
- Auditability:
  - Payout records include gross, dispute adjustment, and net values.
  - Dispute and payout endpoint actions emit metering events.

## Known Risks
- Tax/compliance and withholding rails remain out of scope for S44 and will need expansion in finance/compliance follow-on segments.
- Dispute workflow currently assumes a single resolver role (`owner-platform`) and may need policy-scoped reviewer tiers.

## Next Segment Handoff
- Recommended next segment: `S45` (Procurement controls)
- Required context for next segment:
  - Marketplace finance now supports dispute and payout controls that should be bound to enterprise approval policy packs.

## Mandatory Confirmation
- [x] `docs/agenthub-master-plan-v1.2.docx` updated
- [x] `docs/DELIVERABLE_LOG.md` updated

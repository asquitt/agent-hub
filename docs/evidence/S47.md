# Evidence

## Segment
- ID: S47
- Deliverable(s): Compliance controls
- Date: 2026-02-12

## Code Changes
- Files changed:
  - `.gitignore`
  - `src/compliance/storage.py`
  - `src/compliance/service.py`
  - `src/compliance/__init__.py`
  - `src/api/models.py`
  - `src/api/app.py`
  - `tests/compliance/test_compliance_controls_s47.py`
  - `docs/compliance/COMPLIANCE_CONTROLS_S47.md`
  - `docs/session-packets/S47.md`
- Summary:
  - Added compliance control catalog and automated evidence checks for SOC2/ISO27001.
  - Added persistent compliance evidence report storage and export workflow.
  - Added API endpoints for control catalog lookup, evidence export, and report listing.
  - Enforced admin-only boundaries for compliance evidence export/list operations.
  - Added S47 tests validating successful evidence export, admin boundaries, and failure surfacing for malformed evidence.

## Test Commands Executed
```bash
pytest tests/compliance/test_compliance_controls_s47.py tests/federation/test_gateway.py tests/federation/test_enterprise_pack_s46.py -q
pytest tests/integration/test_registry_api.py tests/cost_governance/test_metering_integration.py tests/marketplace/test_procurement_controls_s45.py tests/operator/test_operator_ui.py -q
pytest -q
```

## Test Results
- Passed:
  - `9 passed in 0.42s` (compliance + federation bundle)
  - `19 passed in 2.54s` (integration/cost/marketplace/operator bundle)
  - `159 passed in 7.48s` (full regression)
- Failed: `0`
- Skipped: `0`

## Verification Evidence
- Control evidence automation:
  - SOC2/ISO control mappings execute deterministic checks for ledger integrity, metering schema, federation audit completeness, procurement audit completeness, and provenance signature validation.
  - Evidence export includes per-control pass/fail status with structured proof payloads.
- Boundary enforcement:
  - Compliance evidence export and listing are restricted to admin actors.
- Validation robustness:
  - Malformed federation audit evidence is surfaced as a failed control in exported reports.

## Known Risks
- Framework mappings currently focus on core controls and should be expanded for broader SOC2/ISO coverage depth.
- Evidence reports are local-file backed and do not yet integrate with external compliance GRC systems.

## Next Segment Handoff
- Recommended next segment: `S48` (Pilot expansion A)
- Required context for next segment:
  - Compliance evidence automation now provides structured control pass/fail reporting suitable for pilot governance reporting loops.

## Mandatory Confirmation
- [x] `docs/agenthub-master-plan-v1.2.docx` updated
- [x] `docs/DELIVERABLE_LOG.md` updated

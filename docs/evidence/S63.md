# Evidence

## Segment
- ID: S63
- Deliverable(s): CLI doctor remote-mode hardening + CI startup preflight gate
- Date: 2026-02-13

## Code Changes
- CLI hardening:
  - `agenthub/cli.py`
    - `doctor` now supports explicit `--remote` mode flag.
    - `--local` and `--remote` are mutually exclusive.
    - Added remote failure taxonomy:
      - `request_error`
      - `http_error`
      - `invalid_json`
- CLI tests:
  - `tests/cli/test_agenthub_cli.py`
    - Added local invalid-env failure case.
    - Added remote missing-api-key failure case.
- CI preflight guard:
  - `.github/workflows/quality-gates.yml`
    - Added `Startup preflight doctor` step in `pytest-targeted` job.
- Documentation:
  - `README.md`
    - Added explicit `doctor --local` and `doctor --remote` examples.

## Test Commands Executed
```bash
pytest -q tests/cli/test_agenthub_cli.py tests/auth/test_startup_diagnostics_s61.py tests/gate/test_architecture_guardrails_s53.py
pytest -q
npm run e2e
```

## Test Results
- Passed:
  - `10 passed` targeted CLI/diagnostics/guardrail suite.
  - `200 passed` full `pytest -q` suite.
  - `8 passed` Playwright e2e suite.
- Failed: `0`
- Skipped: `0`

## Verification Evidence
- `agenthub doctor` now emits deterministic structured error payloads for remote failure classes.
- Negative-path CLI behaviors are covered by subprocess-level tests.
- CI now performs startup preflight before targeted hardening tests, reducing late-stage failures.

## Known Risks
- CI preflight uses fixed test env values and validates configuration shape, not production secret provenance.
- Remote doctor behavior in CI is not yet exercised against a running API service.

## Next Segment Handoff
- Recommended next focus:
  1. Add richer doctor probes for policy/storage/federation path readiness.
  2. Add optional red/yellow/green severity classification for diagnostics checks.
  3. Add remote doctor integration test harness with ephemeral API startup.

## Mandatory Confirmation
- [x] `docs/agenthub-master-plan-v1.2.docx` updated
- [x] `docs/DELIVERABLE_LOG.md` updated
